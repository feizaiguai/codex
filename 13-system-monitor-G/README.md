# System Monitor Skill - 系统监控专家

**版本**: 2.0.0
**类型**: 系统监控
**质量等级**: A+

## 📋 功能概述

全栈监控和健康检查,确保系统稳定运行。

### 核心能力

1. **全栈监控** - CPU、内存、磁盘、网络、JVM、容器全覆盖
2. **健康检查** - Liveness/Readiness探针,依赖服务检测
3. **错误追踪** - 自动捕获异常,聚合相似错误(Sentry集成)
4. **性能指标** - 响应时间P50/P95/P99、QPS、错误率
5. **AI趋势预测** - 预测资源使用,提前告警,扩容建议

## 🚀 使用方法

### Slash Command
```bash
/monitor [监控目标]
```

### 自然语言调用
```
监控系统资源使用情况
检查所有服务的健康状态
```

## 📖 使用示例

### 示例:系统健康检查
**输入**:
```
/monitor --health-check
```

**输出**:
- ✅ 整体健康状态: Healthy
- ✅ CPU使用率: 45% (正常)
- ✅ 内存使用: 12GB/16GB (75%)
- ✅ 磁盘空间: 120GB/500GB (24%)
- ✅ 数据库: Healthy (延迟15ms)
- ✅ Redis: Healthy (延迟2ms)
- ⚠️ 消息队列: 积压500条消息
- ✅ 趋势预测: 3天内内存使用将达90%

## 🎯 监控维度

### 系统资源
- **CPU**: 使用率、负载、上下文切换
- **内存**: 使用率、可用内存、Swap使用
- **磁盘**: 使用率、I/O速率、队列长度
- **网络**: 带宽、连接数、丢包率

### 应用指标
- **请求**: QPS、响应时间、错误率
- **业务**: 订单数、支付成功率、用户活跃数
- **JVM**: 堆内存、GC次数、线程数
- **容器**: CPU/内存限制、重启次数

### 依赖服务
- **数据库**: 连接池、查询延迟、慢查询
- **缓存**: 命中率、延迟、内存使用
- **消息队列**: 队列长度、消费速率、延迟
- **外部API**: 可用性、响应时间、错误率

## 📊 监控报告示例

```markdown
# 系统监控报告

**生成时间**: 2025-01-01 14:30:00
**监控周期**: 最近1小时

## 整体健康状态: ⚠️ Warning

### 系统资源

| 指标 | 当前值 | 状态 | 阈值 |
|------|--------|------|------|
| CPU使用率 | 45% | ✅ 正常 | <70% |
| 内存使用 | 75% | ⚠️ 警告 | <80% |
| 磁盘空间 | 24% | ✅ 正常 | <80% |
| 网络带宽 | 120Mbps | ✅ 正常 | <1Gbps |

### 应用性能

| 指标 | 当前值 | P95 | 状态 |
|------|--------|-----|------|
| QPS | 1,234 | - | ✅ 正常 |
| 响应时间(P50) | 45ms | - | ✅ 正常 |
| 响应时间(P95) | 180ms | 200ms | ✅ 正常 |
| 响应时间(P99) | 450ms | 500ms | ✅ 正常 |
| 错误率 | 0.3% | - | ✅ 正常 |

### 依赖服务健康

| 服务 | 状态 | 延迟 | 详情 |
|------|------|------|------|
| PostgreSQL | ✅ Healthy | 15ms | 连接池: 8/50 |
| Redis | ✅ Healthy | 2ms | 内存: 2.1GB/4GB |
| RabbitMQ | ⚠️ Warning | 35ms | 积压: 500条消息 |
| Elasticsearch | ✅ Healthy | 45ms | 集群绿色 |
| Payment API | ✅ Healthy | 250ms | 成功率: 99.8% |

### 🔮 趋势预测

**内存使用趋势**:
```
当前: 75% (12GB/16GB)
24小时后: 82% ⚠️
3天后: 90% 🔴 (建议扩容)
7天后: 预计达到100% ⚠️ Critical
```

**建议操作**:
1. 增加内存: 16GB → 32GB
2. 优化内存使用: 检查内存泄漏
3. 清理RabbitMQ积压消息

## 错误追踪

### Top 5 错误
1. **DatabaseConnectionTimeout** (12次/小时)
   - 首次出现: 13:45:12
   - 影响: 支付服务
   - 相似错误: 12个

2. **RedisTimeoutException** (5次/小时)
   - 首次出现: 14:10:33
   - 影响: 用户会话
   - 相似错误: 5个
```

## 🔍 Kubernetes健康检查

### Liveness探针
```yaml
livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
```

### Readiness探针
```yaml
readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: 8080
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3
```

## 📈 Grafana仪表板

### 推荐的仪表板
1. **系统概览**: CPU、内存、磁盘、网络
2. **应用性能**: QPS、响应时间、错误率
3. **JVM监控**: 堆内存、GC、线程
4. **数据库**: 连接池、查询延迟、慢查询
5. **业务指标**: 订单量、支付成功率、GMV

## 🛠️ 最佳实践

1. **四个黄金信号**: 延迟、流量、错误、饱和度
2. **SLO定义**: 明确服务级别目标(如99.9%可用性)
3. **告警阈值**: 根据历史数据设置合理阈值
4. **趋势分析**: 关注指标变化趋势,预防性扩容
5. **容量规划**: 基于预测提前规划资源

## 🔗 与其他 Skills 配合

- `log-analyzer`: 结合日志深度分析
- `alert-manager`: 触发智能告警
- `debugger`: 性能问题调试
- `performance-optimizer`: 优化建议

---

**状态**: ✅ 生产就绪 | **质量等级**: A+
