# Log Analyzer Skill - 日志分析专家

**版本**: 2.0.0
**类型**: 日志分析
**质量等级**: A+

## 📋 功能概述

智能日志解析和异常检测,快速定位生产问题根因。

### 核心能力

1. **智能解析** - 自动识别CLF/JSON/Syslog/自定义格式
2. **AI异常检测** - 错误模式、性能异常、安全威胁识别
3. **事件关联** - 跨服务、跨时间关联日志事件
4. **时间线重建** - 重建请求完整生命周期
5. **可视化报告** - 趋势图、错误热力图、QPS曲线

## 🚀 使用方法

### Slash Command
```bash
/analyze-logs [日志文件路径]
```

### 自然语言调用
```
分析这个服务的日志,找出错误原因
分析nginx访问日志,生成流量报告
```

## 📖 使用示例

### 示例:生产故障分析
**输入**:
```
/analyze-logs /var/log/app/*.log --time-range="last 24h"
```

**输出**:
- ✅ 自动识别JSON格式日志
- ✅ 检测到3个异常模式
- ✅ 错误突增:12:30-12:45（3倍基线）
- ✅ 新错误类型:DatabaseConnectionTimeout
- ✅ 事件关联:支付服务→数据库→失败
- ✅ 根因:数据库连接池耗尽
- ✅ 可视化时间线

## 🎯 支持的日志格式

- **Apache CLF**: 127.0.0.1 - - [01/Jan/2025:12:00:00] "GET /api"
- **JSON**: {"timestamp": "2025-01-01T12:00:00Z", "level": "ERROR"}
- **Syslog**: Jan 1 12:00:00 host app[123]: message
- **Logfmt**: level=info timestamp=2025-01-01T12:00:00Z
- **Custom**: 自定义正则表达式解析

## 📊 分析报告示例

```markdown
# 日志分析报告

**分析时间范围**: 2025-01-01 00:00:00 - 2025-01-01 23:59:59
**总日志行数**: 1,245,678
**解析成功率**: 99.8%

## 异常模式检测

### 🔴 Critical: 错误率突增
- **时间**: 12:30-12:45
- **错误数**: 1,234 (基线: 412)
- **增长**: 3倍

### 🟠 High: 新错误类型
- **首次出现**: 12:32:15
- **错误**: DatabaseConnectionTimeout
- **影响**: 支付服务无法处理订单

## 事件时间线

```
12:30:00 | 数据库连接池使用率90%
12:30:15 | 开始出现连接超时
12:32:15 | 首个DatabaseConnectionTimeout
12:35:00 | 支付服务错误率50%
12:40:00 | 触发自动重启
12:45:00 | 服务恢复正常
```

## 根因分析
1. 数据库连接池配置为50
2. 12:30突然涌入大量请求(黑五促销)
3. 连接池耗尽,新请求超时
4. 级联影响支付服务

## 修复建议
1. 增加连接池大小: 50 → 100
2. 添加连接超时告警
3. 实施流量限制和降级
```

## 🔍 异常检测模式

### 错误模式
- **频率突增**: 错误数突然增加3倍+
- **新错误**: 之前未出现的错误类型
- **错误聚类**: 相似错误集中出现
- **级联故障**: 错误传播链路

### 性能异常
- **响应时间**: P95/P99超过阈值
- **慢查询**: 数据库查询>1s
- **超时事件**: 连接/读超时
- **吞吐量下降**: QPS突然降低

### 安全威胁
- **暴力破解**: 短时间大量登录失败
- **SQL注入**: 异常SQL模式
- **异常IP**: 单IP大量请求
- **权限提升**: 未授权访问尝试

## 🛠️ 最佳实践

1. **结构化日志**: 使用JSON格式,包含timestamp、level、message
2. **统一标准**: 跨服务使用统一日志格式和字段名
3. **请求ID**: 添加request_id追踪分布式调用
4. **日志级别**: 合理使用DEBUG/INFO/WARN/ERROR
5. **敏感信息**: 避免记录密码、token等

## 🎨 可视化图表

### 提供的图表类型
- **错误趋势图**: 时间序列错误数量
- **错误热力图**: 按时间和服务的错误分布
- **QPS曲线**: 请求吞吐量变化
- **延迟分布**: P50/P90/P99响应时间
- **状态码分布**: 2xx/4xx/5xx比例
- **Top错误**: 最频繁的错误类型

## 🔗 与其他 Skills 配合

- `debugger`: 结合日志深度调试问题
- `system-monitor`: 关联系统指标分析
- `alert-manager`: 触发告警通知

---

**状态**: ✅ 生产就绪 | **质量等级**: A+
